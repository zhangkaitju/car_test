!function(Z){"use strict";var P="ht",y=Z[P],x=y.Default,e=Math,w=e.PI,Y=2*w,V=e.sin,$=e.cos,s=e.atan2,Q=e.sqrt,B=e.max,W=e.floor,X=(e.round,e.ceil),g=e.abs,t=y.Shape,S=y.Edge,I=y.List,n=y.Style,c=y.graph,D=x.getInternal(),m=D.ui(),H=null,A="__segmentLengths",h="__lineTotalLength",r="__linePoints",L="__distance0",E="flow.count",d="flow.step",_="flow.element.max",u="flow.element.count",N="flow.element.min",T="flow.element.space",C="flow.element.autorotate",O="flow.element.background",J="flow.element.shadow.max",p="flow.element.shadow.min",q="flow.element.shadow.begincolor",R="flow.element.shadow.endcolor",o="flow.element.shadow.visible",G="flow.element.image",j="flow",i="prototype",k=function(r){return document.createElement(r)},v=function(d){for(var G=0,e=d.length-1,A=0;e>A;A++){var _=d[A],r=d[A+1],Z=r.x-_.x,B=r.y-_.y,g=Q(Z*Z+B*B);G+=g}return G},M=function(N,y){for(var t=0,O=0,d=0,x=N.length-1,g=0;x>g;g++){var o=N[g],Y=N[g+1],K=Y.x-o.x,b=Y.y-o.y;if(d=Q(K*K+b*b),t+=d,t>y){t-=d,O=g;break}}var W=N[O],T=N[O+1],Z=s(T.y-W.y,T.x-W.x),r=y-t,b=V(Z)*r,K=$(Z)*r;return{x:W.x+K,y:W.y+b}},U=function(v,P,c,t){var g=$(t),b=V(t),Y=g*P-b*c,W=b*P+g*c;return v?{x:v.x+Y,y:v.y+W}:{x:Y,y:W}},b=function(x,l){x[A]=x[h]=x[r]=l[L]=H},f=function(G,d,n,B,y,b){var r,u,z,p,P,s,f,m,Z,E,I,t=[];if(g(B)>Y&&(B=Y),P=X(g(B)/(w/4)),r=B/P,u=-r,z=-n,P>0){s=G+$(n)*y,f=d+V(-n)*b,t.push({x:s,y:f});for(var J=0;P>J;J++)z+=u,p=z-u/2,m=G+$(z)*y,Z=d+V(z)*b,E=G+$(p)*(y/$(u/2)),I=d+V(p)*(b/$(u/2)),t.push({x:E,y:I}),t.push({x:m,y:Z})}return t},z=function(P){var W,$,p=P._data;if(p instanceof t){if(W=p.getPoints(),$=p.getSegments(),(!$||0===$.size())&&W){$=new y.List([1]);for(var d=1;d<W.size();d++)$.add(2)}}else if(p instanceof S){var g=P._78o;if(g){var C=g.type,Q=g.points,j=g.segments,B=g._4O;if(!C||Q){var O=g._69o,V=O.x,c=O.y,R=g._70o,F=R.x,u=R.y;if(C)j?(W=new I({x:V,y:c}),W.addAll(Q),W.add({x:F,y:u}),$=new I(j._as)):(W=new I({x:V,y:c}),$=new I([1]),Q.each(function(g){W.add(g),$.add(2)}),W.add({x:F,y:u}),$.add(2));else if(g.looped){W=new I(f(V,c,0,Y,g.radius,g.radius)),$=new I([1]);for(var d=0;d<(W.size()-1)/2;d++)$.add(3)}else W=new I,g.center?(W.add({x:g.c1.x,y:g.c1.y}),W.add({x:V,y:c}),W.add({x:F,y:u}),W.add({x:g.c2.x,y:g.c2.y}),$=new I([1,2,2,2])):(W.add({x:V,y:c}),W.add({x:F,y:u}),$=new I([1,2]))}else if(B)if(W=new I(B.points._as),B.segments)$=new I(B.segments._as);else{$=new I([1]);for(var d=1;d<B.points.size();d++)$.add(2)}}}if(W&&$){for(var z=D.toPointsArray(W._as,$._as,50),n=z.length,U=[],d=0;n>d;d++){var E=z[d];E.length>1&&U.push(z[d])}p.s("flow.reverse")&&(U.reverse(),U.forEach(function(q){q.reverse()}));for(var m=0,s=[],M=U.length,d=0;M>d;d++){var E=U[d],N=v(E);m+=N,s.push(N)}if(p[A]=s,p[h]=m,p[r]=U,p instanceof S){var J=x.unionPoint(U),G=J.x+J.width/2,e=J.y+J.height/2;p.$10e={x:G,y:e}}K(P,!0)}},K=function(v,w){var n=v._data,F=n[h],P=n.s(E),Q=n.s(d),G=0,t=n[A],b=n.s(_),D=n.s(N),H=n.s(u),X=(b-D)/(H-1),p=[];if(t){if(1===H)p.push(b);else if(2===H)p.push(b),p.push(D);else{if(!(H>2))return;p.push(b);for(var q=H-2;q>0;q--)p.push(D+X*q);p.push(D)}var Z=0,W=0;p.forEach(function(t){H-1>Z&&(W+=n.getFlowElementSpace(t)),Z++}),W+=(b+D)/2,G=(F-P*W+W)/P;var e=v[L];for(null==e&&(e=0),w||(e+=Q);e>F+W;){var f=v._overCount;f?f++:f=1,f>=P&&(f=null),v._overCount=f,n.s("flow.autoreverse")?f?e-=G+W:(e=0,n.s("flow.reverse",!n.s("flow.reverse"))):e-=G+W}v[L]=e}},F=function(g){var e=g.data,$=this.dm();if(e&&"add"===g.kind){var E=$.$3e;E&&e.s(j)&&E.indexOf(e)<0&&E.push(e)}"clear"===g.kind&&($.$3e=[])},a=function(q){var k=q.property,y=q.data,V=q.newValue,L=this.dm().$3e;if(L&&"s:flow"===k)if(V)L.indexOf(y)<0&&L.push(y);else for(var m=L.length,h=0;m>h;h++)if(L[h]===y){L.splice(h,1);break}},l=function(Q,S){for(var w=0,$=S.length,A=0;$>A;A++){var j=S[A];if(w+=j,w>Q)return A}return A},Lc=function(D){var t=this,m=t._data,X=m[h],x=m[A],S=m[r],v=m.s(E),y=0,j=t[L],F=m.s(_),G=m.s(N),i=m.s(u),o=m.s(p),b=m.s(J),Y=m.s(C),K=(b-o)/(i-1),$=(F-G)/(i-1),P=m.getRotation?m.getRotation():0,k=m.getPosition?m.p():m.$10e,O=[],n=[];if(j!=H){if(1===i)O.push(F);else if(2===i)O.push(F),O.push(G);else{if(!(i>2))return;O.push(F);for(var g=i-2;g>0;g--)O.push(G+$*g);O.push(G)}if(1===i)n.push(b);else if(2===i)n.push(b),n.push(o);else{if(!(i>2))return;n.push(b);for(var g=i-2;g>0;g--)n.push(o+K*g);n.push(o)}var a=0,B=0;O.forEach(function(t){i-1>a&&(B+=m.getFlowElementSpace(t)),a++}),B+=(F+G)/2,y=(X-v*B+B)/v,D.save();for(var g=0;v>g;g++){var z=j,c=0,Z=t._overCount,e=0;m.s("flow.autoreverse")&&Z&&Z>v-(g+1)||(z-=g*(y+B),a=0,O.forEach(function(W){var F=z-c;if(F>=0&&X>F){var R=!0,B=l(F,x);e=0;for(var J=0;B>J;J++)e+=x[J];if(F-=e,R){var N=M(S[B],F),g=P;if(Y){for(var E=S[B],o=0,y=0,h=0;h<E.length-1;h++){var u=E[h],w=E[h+1],j=w.x-u.x,r=w.y-u.y,I=Q(j*j+r*r);if(o+=I,o>F){y=h;break}}var i=E[y];g+=s(N.y-i.y,N.x-i.x)}P&&(N=U(k,N.x-k.x,N.y-k.y,P)),t.$5e(D,N,W,n[a],g)}}c+=m.getFlowElementSpace(O[a]),a++}))}D.restore()}},Pr=c.GraphView[i],We=y.Data[i],fk=m.DataUI[i],Tc=m.ShapeUI[i],rh=m.EdgeUI[i],ur=y.DataModel[i],Wq=Tc._80o,so=rh._80o,Xo=ur.prepareRemove,Kn=rh._79o,gi=Tc._79o,Cc=Pr.setDataModel,Ei=function(){var O=this,k=O._data,Z=k.s(_),C=!1,f=H;if(O._6I||(C=!0),f=k instanceof S?Kn.call(O):gi.call(O),k.s(j)&&C){var g=k.s(J),V=k.s(o);V&&g>Z&&(Z=g),Z>0&&x.grow(f,X(Z/2)),z(O)}return!k.s(j)&&C&&b(k,O),f};We.getFlowElementSpace=function(){return this.s(T)},Tc._79o=Ei,rh._79o=Ei,n[_]==H&&(n[_]=7),n[N]==H&&(n[N]=0),n[E]==H&&(n[E]=1),n[d]==H&&(n[d]=3),n[u]==H&&(n[u]=10),n[T]==H&&(n[T]=3.5),n[C]==H&&(n[C]=!1),n[O]==H&&(n[O]="rgba(255, 255, 114, 0.4)"),n[q]==H&&(n[q]="rgba(255, 255, 0, 0.3)"),n[R]==H&&(n[R]="rgba(255, 255, 0, 0)"),n[o]==H&&(n[o]=1),n[J]==H&&(n[J]=22),n[p]==H&&(n[p]=4),ur.prepareRemove=function(l){Xo.call(this,l);var W=l._dataModel,x=W.$3e;if(x)for(var Q=x.length,Y=0;Q>Y;Y++)if(x[Y]===l){x.splice(Y,1);break}},Pr.setDataModel=function(C){var i=this,U=i._dataModel;if(U!==C){U&&(U.umm(F,i),U.umd(a,i),U.$3e=[]),C.mm(F,i),C.md(a,i);var h=C.$3e=[];C.each(function(c){c.s(j)&&h.indexOf(c)<0&&h.push(c)}),Cc.call(i,C)}},Pr.setFlowInterval=function(M){var m=this,f=m.$11e;m.$11e=M,m.fp("flowInterval",f,M),m.$7e!=H&&(clearInterval(m.$7e),delete m.$7e,m.enableFlow(M))},Pr.getFlowInterval=function(){return this.$11e},Pr.$9e=function(){var t,U,c,K=this,d=K.tx(),u=K.ty(),F=K.getZoom(),z=K.getWidth(),V=K.getHeight(),Q={x:-d/F,y:-u/F,width:z/F,height:V/F},O=K.dm().$3e,L=K._56I,G=new I;if(O.forEach(function(i){L[i.getId()]&&(t=K.getDataUI(i),t&&(c=t._79o(),c&&G.add(c)))}),0!==G.size()&&(G.each(function(W){x.intersectsRect(Q,W)&&(U=x.unionRect(U,W))}),U&&(U&&(x.grow(U,B(1,1/F)),U.x=W(U.x*F)/F,U.y=W(U.y*F)/F,U.width=X(U.width*F)/F,U.height=X(U.height*F)/F,U=x.intersection(Q,U)),U))){var _=K._canvas.getContext("2d");_.save(),_.lineCap=x.lineCap,_.lineJoin=x.lineJoin,D.translateAndScale(_,d,u,F),_.beginPath(),_.rect(U.x,U.y,U.width,U.height),_.clip(),_.clearRect(U.x,U.y,U.width,U.height),K.$6e(_,U),_.restore()}},Pr.$6e=function(K,I){var M,B,C=this;C._93db(K),C.each(function(z){C._56I[z._id]&&(M=C.getDataUI(z),M&&(B=M._79o(),(!I||x.intersectsRect(I,B))&&M._42(K)))}),C._92db(K)},Pr.enableFlow=function(o){var F=this,r=F.dm(),W=r.$3e;F.$7e==H&&(W.forEach(function(g){var X=F.getDataUI(g);z(X)}),F.$7e=setInterval(function(){r.$3e.forEach(function(D){K(F.getDataUI(D))}),F.$9e()},o||F.$11e||50))},Pr.disableFlow=function(){var Z=this;clearInterval(Z.$7e),delete Z.$7e;var W=Z.dm().$3e;W&&Z.$9e()},fk.$5e=function(j,K,Q,B,Z){var P=this,X=P._data,I=P.gv,c=X.s(O),N=X.s(q),a=X.s(R),e=X.s(o),f=I.$8e,A=X.s(G);if(f==H&&(f=I.$8e={}),j.beginPath(),A!=H){var z=x.getImage(A),W=Q/2;j.translate(K.x,K.y),j.rotate(Z),j.translate(-K.x,-K.y),x.drawImage(j,z,K.x-W,K.y-W,Q,Q,X),j.translate(K.x,K.y),j.rotate(-Z),j.translate(-K.x,-K.y)}else j.fillStyle=c,j.arc(K.x,K.y,Q/2,0,Y,!0),j.fill();if(e){var y=22,L=y+"_"+N+"_"+a,g=f[L];if(g==H){var w=k("canvas");D.setCanvas(w,y,y);var p=w.getContext("2d"),v=y/2,C=v,J=v;D.translateAndScale(p,0,0,1),p.beginPath();var s=p.createRadialGradient(C,J,0,C,C,v);s.addColorStop(0,N),s.addColorStop(1,a),p.fillStyle=s,p.arc(C,J,v,0,Y,!0),p.fill(),g=f[L]=w}var W=B/2;x.drawImage(j,g,K.x-W,K.y-W,B,B,X)}},rh._80o=function(h){so.call(this,h);var X=this,r=X._data,L=X.gv;r.s(j)&&L.$7e!=H&&Lc.call(X,h)},Tc._80o=function(a){Wq.call(this,a);var M=this,r=M._data,x=M.gv;r.s(j)&&x.$7e!=H&&Lc.call(M,a)}}(this,Object);